package Omtbs;

import java.awt.HeadlessException;
import java.util.*;
import javax.mail.*;
import javax.mail.internet.*;
import javax.activation.*;
import java.awt.Toolkit;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import java.sql.*;
import java.util.logging.Level;
import java.util.logging.Logger;

/* @author richu */

public class AdminRegisterMail extends javax.swing.JFrame {

    String from,to,host,sub;
    int content;
    String newline = System.lineSeparator();
    public  int PassOtp;
    
    /* Creates new form AdminRegisterMail */
    public AdminRegisterMail() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        AdminRegisterMailPanel = new javax.swing.JPanel();
        CompanyLogo = new javax.swing.JLabel();
        CloseButton = new javax.swing.JLabel();
        MinimizeButton = new javax.swing.JLabel();
        MaximizeButton = new javax.swing.JLabel();
        EmailLabel = new javax.swing.JLabel();
        EmailTextField = new javax.swing.JTextField();
        SentButton = new javax.swing.JButton();
        OtpPasswordLabel = new javax.swing.JLabel();
        OtpPasswordTextField = new javax.swing.JTextField();
        VerifyButton = new javax.swing.JButton();
        GoBackLabel = new javax.swing.JLabel();
        BgAdminMailImg = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Admin Registration Mail");
        setLocationByPlatform(true);
        setName("AdminRegistrationMailFrame"); // NOI18N
        setUndecorated(true);

        AdminRegisterMailPanel.setBackground(new java.awt.Color(255, 255, 204));
        AdminRegisterMailPanel.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        CompanyLogo.setFont(new java.awt.Font("Trebuchet MS", 3, 36)); // NOI18N
        CompanyLogo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/OmtbsImages/lightning _50px.png"))); // NOI18N
        CompanyLogo.setText("ADMIN REGISTRATION ");
        CompanyLogo.setCursor(new java.awt.Cursor(java.awt.Cursor.WAIT_CURSOR));
        AdminRegisterMailPanel.add(CompanyLogo, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 10, 440, 50));

        CloseButton.setFont(new java.awt.Font("Trebuchet MS", 1, 18)); // NOI18N
        CloseButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/OmtbsImages/Cross_50px.png"))); // NOI18N
        CloseButton.setText("4");
        CloseButton.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        CloseButton.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                CloseButtonMouseClicked(evt);
            }
        });
        AdminRegisterMailPanel.add(CloseButton, new org.netbeans.lib.awtextra.AbsoluteConstraints(1070, 10, 50, 50));

        MinimizeButton.setFont(new java.awt.Font("Trebuchet MS", 1, 18)); // NOI18N
        MinimizeButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/OmtbsImages/Minimize_50px.png"))); // NOI18N
        MinimizeButton.setText("4");
        MinimizeButton.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                MinimizeButtonMouseClicked(evt);
            }
        });
        AdminRegisterMailPanel.add(MinimizeButton, new org.netbeans.lib.awtextra.AbsoluteConstraints(1000, 10, 50, 50));

        MaximizeButton.setFont(new java.awt.Font("Trebuchet MS", 1, 18)); // NOI18N
        MaximizeButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/OmtbsImages/Maximize_50px.png"))); // NOI18N
        MaximizeButton.setText("4");
        MaximizeButton.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                MaximizeButtonMouseClicked(evt);
            }
        });
        AdminRegisterMailPanel.add(MaximizeButton, new org.netbeans.lib.awtextra.AbsoluteConstraints(930, 10, 50, -1));

        EmailLabel.setFont(new java.awt.Font("Trebuchet MS", 1, 18)); // NOI18N
        EmailLabel.setText("EMAIL ID:");
        AdminRegisterMailPanel.add(EmailLabel, new org.netbeans.lib.awtextra.AbsoluteConstraints(310, 220, 90, 50));

        EmailTextField.setBackground(new java.awt.Color(204, 204, 204));
        EmailTextField.setFont(new java.awt.Font("Trebuchet MS", 1, 18)); // NOI18N
        EmailTextField.setForeground(new java.awt.Color(51, 51, 51));
        EmailTextField.setToolTipText("");
        EmailTextField.setAutoscrolls(false);
        EmailTextField.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(255, 255, 255), 3, true));
        EmailTextField.setMargin(new java.awt.Insets(4, 4, 4, 4));
        AdminRegisterMailPanel.add(EmailTextField, new org.netbeans.lib.awtextra.AbsoluteConstraints(400, 220, 370, 50));

        SentButton.setBackground(new java.awt.Color(255, 255, 0));
        SentButton.setFont(new java.awt.Font("Trebuchet MS", 1, 18)); // NOI18N
        SentButton.setText("Sent");
        SentButton.setBorderPainted(false);
        SentButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                SentButtonActionPerformed(evt);
            }
        });
        AdminRegisterMailPanel.add(SentButton, new org.netbeans.lib.awtextra.AbsoluteConstraints(500, 300, 180, 50));

        OtpPasswordLabel.setFont(new java.awt.Font("Trebuchet MS", 1, 18)); // NOI18N
        OtpPasswordLabel.setText("OTP PASSWORD:");
        AdminRegisterMailPanel.add(OtpPasswordLabel, new org.netbeans.lib.awtextra.AbsoluteConstraints(250, 410, 150, 50));

        OtpPasswordTextField.setBackground(new java.awt.Color(204, 204, 204));
        OtpPasswordTextField.setFont(new java.awt.Font("Trebuchet MS", 1, 18)); // NOI18N
        OtpPasswordTextField.setForeground(new java.awt.Color(51, 51, 51));
        OtpPasswordTextField.setToolTipText("");
        OtpPasswordTextField.setAutoscrolls(false);
        OtpPasswordTextField.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(255, 255, 255), 3, true));
        OtpPasswordTextField.setMargin(new java.awt.Insets(4, 4, 4, 4));
        AdminRegisterMailPanel.add(OtpPasswordTextField, new org.netbeans.lib.awtextra.AbsoluteConstraints(400, 410, 370, 50));

        VerifyButton.setBackground(new java.awt.Color(51, 255, 0));
        VerifyButton.setFont(new java.awt.Font("Trebuchet MS", 1, 18)); // NOI18N
        VerifyButton.setText("Verify");
        VerifyButton.setBorderPainted(false);
        VerifyButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                VerifyButtonActionPerformed(evt);
            }
        });
        AdminRegisterMailPanel.add(VerifyButton, new org.netbeans.lib.awtextra.AbsoluteConstraints(500, 490, 180, 50));

        GoBackLabel.setFont(new java.awt.Font("Trebuchet MS", 1, 24)); // NOI18N
        GoBackLabel.setForeground(new java.awt.Color(255, 255, 255));
        GoBackLabel.setIcon(new javax.swing.ImageIcon(getClass().getResource("/OmtbsImages/Previous_50px.png"))); // NOI18N
        GoBackLabel.setText("GO BACK");
        GoBackLabel.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                GoBackLabelMouseClicked(evt);
            }
        });
        AdminRegisterMailPanel.add(GoBackLabel, new org.netbeans.lib.awtextra.AbsoluteConstraints(960, 650, 160, -1));

        BgAdminMailImg.setFont(new java.awt.Font("Trebuchet MS", 1, 18)); // NOI18N
        BgAdminMailImg.setIcon(new javax.swing.ImageIcon(getClass().getResource("/OmtbsImages/Drew_beamer_1130px.jpg"))); // NOI18N
        AdminRegisterMailPanel.add(BgAdminMailImg, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1130, 710));

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(AdminRegisterMailPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(AdminRegisterMailPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        setSize(new java.awt.Dimension(1130, 710));
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void CloseButtonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_CloseButtonMouseClicked
        System.exit(0);
    }//GEN-LAST:event_CloseButtonMouseClicked

    private void MinimizeButtonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_MinimizeButtonMouseClicked
        this.setState(JFrame.ICONIFIED);
    }//GEN-LAST:event_MinimizeButtonMouseClicked

    private void MaximizeButtonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_MaximizeButtonMouseClicked
        if(this.getExtendedState()!= Login.MAXIMIZED_BOTH){
            this.setExtendedState(Login.MAXIMIZED_BOTH);
        }
        else{
            this.setExtendedState(Login.NORMAL);
        }
    }//GEN-LAST:event_MaximizeButtonMouseClicked

    private void GoBackLabelMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_GoBackLabelMouseClicked
       AdminLogin al= new AdminLogin();
       al.setVisible(true);
       al.pack();
       al.setLocationRelativeTo(null);
       al.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
       this.dispose();
    }//GEN-LAST:event_GoBackLabelMouseClicked

    private void SentButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_SentButtonActionPerformed
        String regex = "^[a-zA-Z0-9_+&*-]+(?:\\." + "[a-zA-Z0-9_+&*-]+)*@" + "(?:[a-zA-Z0-9-]+\\.)+[a-z" + "A-Z]{2,7}$";
        Pattern p = Pattern.compile(regex);
        Matcher emailmatch = p.matcher(EmailTextField.getText());
        String semail= EmailTextField.getText();
        if(semail.equals("")){
            Toolkit.getDefaultToolkit().beep();
            JOptionPane.showMessageDialog(null,"Please Enter The Email id" , "Email Id", JOptionPane.WARNING_MESSAGE);
            EmailTextField.requestFocus();
        }
        else if(emailmatch.matches()){
            try{
                PassOtp = MailOtp();
                System.out.print(PassOtp);
                System.out.print(newline);
            
                from = "omtbs1818@gmail.com";
                to = EmailTextField.getText();
                host = "localhost";
                sub = "OTP VERIFICATION";
                content = PassOtp;   
                
                Properties n = new Properties();
                n.put("mail.smtp.auth", "true");
                n.put("mail.starttls.enable", "true");
                n.put("mail.smtp.host", "smtp.gmail.com");
                n.put("mail.smtp.port", "465");
                n.put("mail.smtp.socketFactory.port", "465");    
                n.put("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory");
                Session s = Session.getDefaultInstance(n, new javax.mail.Authenticator() {
                    protected PasswordAuthentication getPasswordAuthentication()
                    {
                        return new PasswordAuthentication("omtbs1818@gmail.com","Omtbs@123456789");
                    }
                });
                try
                {
                    MimeMessage m = new MimeMessage(s);
                    m.setFrom(from);
                    m.addRecipient(Message.RecipientType.TO, new InternetAddress(to));
                    m.setSubject(sub);
                    m.setText(Integer.toString(content)); 
                    Transport.send(m);
                    System.out.println("success");
                    JOptionPane.showMessageDialog(null, "OTP Is Successfully Send To The Email Address.", "Verification OTP Message", JOptionPane.INFORMATION_MESSAGE);
                    OtpPasswordTextField.requestFocus();
                }
                catch(HeadlessException | MessagingException e)
                {
                    Toolkit.getDefaultToolkit().beep();
                    JOptionPane.showMessageDialog(null,"Email Address Doesn't Exist" , "Mail Fetch Error!", JOptionPane.ERROR_MESSAGE);
                }
            } 
            catch(HeadlessException ex){
                Logger.getLogger(ForgetPassword.class.getName()).log(Level.SEVERE, null, ex);
                Toolkit.getDefaultToolkit().beep();
                JOptionPane.showMessageDialog(null,"Mail Address Fetch Unsuccessfully!" , "Mail Fetch Error!", JOptionPane.ERROR_MESSAGE);
            }
        }
        else{
            Toolkit.getDefaultToolkit().beep();
            JOptionPane.showMessageDialog(null,"Please Enter A Valid Email Id" , "Email Id", JOptionPane.WARNING_MESSAGE);
        }   
    }//GEN-LAST:event_SentButtonActionPerformed

    private void VerifyButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_VerifyButtonActionPerformed
        String re = "^[a-zA-Z+&*-]{0,29}$";
        Pattern p = Pattern.compile(re);
        Matcher passmatch = p.matcher(OtpPasswordTextField.getText());
        
        String votp = OtpPasswordTextField.getText();
        if(votp.equals("")){
            Toolkit.getDefaultToolkit().beep();
            JOptionPane.showMessageDialog(null,"Please Enter The OTP" , "OTP", JOptionPane.WARNING_MESSAGE);
        }
        else if(passmatch.matches()){
            Toolkit.getDefaultToolkit().beep();
            JOptionPane.showMessageDialog(null,"Please Enter A Valid OTP" , "Valid OTP", JOptionPane.WARNING_MESSAGE);
        }
        else if(Integer.valueOf(OtpPasswordTextField.getText()) == PassOtp){
            AdminRegister ar = new AdminRegister();
            ar.setVisible(true);
            ar.pack();
            ar.setLocationRelativeTo(null);
            ar.setExtendedState(JFrame.EXIT_ON_CLOSE);
            this.dispose();
        }
        else{
            Toolkit.getDefaultToolkit().beep();
            JOptionPane.showMessageDialog(null, "Invalid Otp!", "OTP Generation Error.", JOptionPane.WARNING_MESSAGE);
        }
    }//GEN-LAST:event_VerifyButtonActionPerformed

     private  int MailOtp(){
       int Motp = (int) (Math.random()*1000000); 
       return Motp;
    }
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException | InstantiationException | IllegalAccessException | javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(AdminRegisterMail.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new AdminRegisterMail().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel AdminRegisterMailPanel;
    private javax.swing.JLabel BgAdminMailImg;
    private javax.swing.JLabel CloseButton;
    private javax.swing.JLabel CompanyLogo;
    private javax.swing.JLabel EmailLabel;
    public javax.swing.JTextField EmailTextField;
    private javax.swing.JLabel GoBackLabel;
    private javax.swing.JLabel MaximizeButton;
    private javax.swing.JLabel MinimizeButton;
    private javax.swing.JLabel OtpPasswordLabel;
    public javax.swing.JTextField OtpPasswordTextField;
    private javax.swing.JButton SentButton;
    private javax.swing.JButton VerifyButton;
    // End of variables declaration//GEN-END:variables
}
